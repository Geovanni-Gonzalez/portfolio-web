---
import { languages } from '../i18n/ui';
import { getLangFromUrl } from '../i18n/utils';

const currentLang = getLangFromUrl(Astro.url);
---

<script type="module" >
  const button = document.getElementById("lang-menu-button");
  const menu = document.getElementById("lang-menu");

  function closeMenu(e) {
    if (!button.contains(e.target) && !menu.contains(e.target)) {
      menu.classList.add("hidden");
      document.removeEventListener("click", closeMenu);
    }
  }

  button.addEventListener("click", () => {
    menu.classList.toggle("hidden");
    setTimeout(() => {
      if (!menu.classList.contains("hidden")) {
        document.addEventListener("click", closeMenu);
      }
    }, 0);
  });
</script>

<div class="relative">
  <button
    id="lang-menu-button"
    type="button"
    class="inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md shadow-sm"
  >
    ğŸŒ {languages[currentLang]}
    <svg
      class="ml-2 h-5 w-5"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div
    id="lang-menu"
    class="hidden absolute right-0 mt-2 w-36 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50"
  >
    <ul class="py-1 text-sm text-gray-700">
      {Object.entries(languages).map(([lang, label]) => (
        <li>
          <a href={`/${lang}/`} class="block px-4 py-2 hover:bg-gray-100">
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</div>

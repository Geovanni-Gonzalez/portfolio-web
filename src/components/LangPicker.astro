---
import { languages } from '../i18n/ui';
import { getLangFromUrl } from '../i18n/utils';

const currentLang = getLangFromUrl(Astro.url);
---

<script type="module" >
  const button = document.getElementById("lang-menu-button");
  const menu = document.getElementById("lang-menu");

  function closeMenu(e) {
    if (!button.contains(e.target) && !menu.contains(e.target)) {
      menu.classList.add("hidden");
      document.removeEventListener("click", closeMenu);
    }
  }

  button.addEventListener("click", () => {
    menu.classList.toggle("hidden");
    setTimeout(() => {
      if (!menu.classList.contains("hidden")) {
        document.addEventListener("click", closeMenu);
      }
    }, 0);
  });
</script>
<div class="relative">
  <button
    id="lang-menu-button"
    type="button"
    class="inline-flex items-center px-4 py-2 border border-white/30 bg-transparent text-white text-sm font-medium rounded-md hover:bg-white/10 hover:border-white transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50"
  >
     {languages[currentLang]}
    <svg
      class="ml-2 h-5 w-5 text-white"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div
    id="lang-menu"
    class="hidden absolute right-0 mt-2 w-36 rounded-md shadow-lg bg-indigo-900 bg-opacity-90 ring-1 ring-indigo-700 ring-opacity-80 z-50"
  >
    <ul class="py-1 text-sm text-indigo-200">
      {Object.entries(languages).map(([lang, label]) => (
        <li>
          <a href={`/${lang}/`} class="block px-4 py-2 hover:bg-indigo-700 hover:text-white transition">
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</div>

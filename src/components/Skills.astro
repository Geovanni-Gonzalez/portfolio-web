---
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { Icon } from "astro-iconify";
import skillsData from "../data/skills.json";
import AOSWrapper from "../components/AOSWrapper.jsx";
import GradientTitle from "./GradientTitle.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const skills = skillsData.skills[lang] || skillsData.skills["en"];
---

<section
  id="skills"
  class="max-w-6xl mx-auto py-20 px-4 sm:px-6 lg:px-8 text-text scroll-mt-20"
  data-aos="fade-up"
  data-aos-duration="1000"
  data-aos-delay="100"
  data-aos-once="true"
>
  <AOSWrapper client:load />

  <GradientTitle title={t("skills.title")} />

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
    {
      skills.map((category, index) => (
        <div
          class="spotlight-card bg-gradient-to-br from-bg/95 via-muted/5 to-bg/95 backdrop-blur-xl
             rounded-3xl border border-text/10 shadow-2xl hover:shadow-orange-400/30
             transition-transform duration-400 hover:scale-[1.03]
             flex flex-col
             h-[520px] overflow-hidden relative group"
          aria-label={category.category}
          data-aos="zoom-in-up"
          data-aos-delay={index * 100}
          data-aos-once="true"
        >
          <h3
            class="relative z-20 text-center text-lg sm:text-xl font-bold bg-gradient-to-r from-orange-400 via-yellow-400 to-orange-600
               bg-clip-text text-transparent py-4 bg-bg/95 backdrop-blur-md
               border-b border-orange-400/20 rounded-t-3xl shadow-sm"
          >
            {category.category}
          </h3>

          {/* Mask Gradients for smooth fade in/out */}
          <div class="absolute inset-x-0 top-[60px] h-10 bg-gradient-to-b from-[var(--color-bg)] to-transparent z-10 pointer-events-none" />
          <div class="absolute inset-x-0 bottom-0 h-10 bg-gradient-to-t from-[var(--color-bg)] to-transparent z-10 pointer-events-none" />

          {/* Marquee Wrapper */}
          <div class="flex-1 overflow-hidden relative">
            <div class="animate-marquee-vertical flex flex-col hover:pause-animation">
              {/* Original List */}
              <ul class="px-3 py-4 grid grid-cols-2 gap-4 pb-8">
                {category.items.map((skill, i) => (
                  <li
                    class="flex flex-col items-center text-center bg-bg/90 p-4 rounded-xl
                         border border-orange-500/50 shadow-md hover:shadow-orange-400/40
                         transition-transform duration-300 hover:scale-105 cursor-default"
                    title={`${skill.name} - ${skill.level}`}
                  >
                    <div class="w-14 h-14 mb-4 flex items-center justify-center">
                      <Icon
                        name={skill.icon}
                        class="w-10 h-10 transition duration-300 hover:brightness-110"
                        aria-hidden="true"
                      />
                    </div>
                    <span class="text-base sm:text-lg font-medium">
                      {skill.name}
                    </span>
                    <div class="mt-2 w-full flex flex-col items-center gap-1">
                      <span class="text-[10px] uppercase tracking-tighter text-orange-400 font-bold">
                        {skill.level}
                      </span>
                      <div class="w-full h-1 bg-zinc-800 rounded-full overflow-hidden">
                        <div
                          class="h-full bg-gradient-to-r from-orange-600 to-yellow-400 transition-all duration-1000 ease-out"
                          style={{
                            width:
                              skill.level === "Básico" ||
                              skill.level === "Basic"
                                ? "33%"
                                : skill.level === "Intermedio" ||
                                    skill.level === "Intermediate"
                                  ? "66%"
                                  : "100%",
                          }}
                        />
                      </div>
                    </div>
                  </li>
                ))}
              </ul>
              {/* Duplicate List for Loop */}
              <ul
                class="px-3 py-4 grid grid-cols-2 gap-4 pb-8"
                aria-hidden="true"
              >
                {category.items.map((skill, i) => (
                  <li
                    class="flex flex-col items-center text-center bg-bg/90 p-4 rounded-xl
                         border border-orange-500/50 shadow-md hover:shadow-orange-400/40
                         transition-transform duration-300 hover:scale-105 cursor-default"
                    title={`${skill.name} - ${skill.level}`}
                  >
                    <div class="w-14 h-14 mb-4 flex items-center justify-center">
                      <Icon
                        name={skill.icon}
                        class="w-10 h-10 transition duration-300 hover:brightness-110"
                        aria-hidden="true"
                      />
                    </div>
                    <span class="text-base sm:text-lg font-medium">
                      {skill.name}
                    </span>
                    <div class="mt-2 w-full flex flex-col items-center gap-1">
                      <span class="text-[10px] uppercase tracking-tighter text-orange-400 font-bold">
                        {skill.level}
                      </span>
                      <div class="w-full h-1 bg-zinc-800 rounded-full overflow-hidden">
                        <div
                          class="h-full bg-gradient-to-r from-orange-600 to-yellow-400 transition-all duration-1000 ease-out"
                          style={{
                            width:
                              skill.level === "Básico" ||
                              skill.level === "Basic"
                                ? "33%"
                                : skill.level === "Intermedio" ||
                                    skill.level === "Intermediate"
                                  ? "66%"
                                  : "100%",
                          }}
                        />
                      </div>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</section>

{/* Extracted SkillItem for cleanliness */}
{
  /* Using a local function component logic isn't standard in .astro files mid-render, so strictly rewriting inline or defining above is better. 
     I will rewrite inline to minimize structure changes, but since I need it twice, defining a simple functional rendering helper or duplicating code is needed.
     For Astro, I can just map twice with the same code block. */
}

<style>
  @keyframes marquee-vertical {
    0% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(-50%);
    }
  }

  .animate-marquee-vertical {
    animation: marquee-vertical 20s linear infinite;
  }

  /* Pause on hover for accessibility */
  .hover\:pause-animation:hover {
    animation-play-state: paused;
  }
</style>

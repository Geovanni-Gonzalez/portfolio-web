---
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { Icon } from "astro-iconify";
import skillsData from "../data/skills.json";
import AOSWrapper from "../components/AOSWrapper.jsx";
import GradientTitle from "./GradientTitle.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const skills = skillsData.skills[lang] || skillsData.skills["en"];
---

<section
  id="skills"
  class="max-w-6xl mx-auto py-20 px-4 sm:px-6 lg:px-8 text-text scroll-mt-20"
  data-aos="fade-up"
  data-aos-duration="1000"
  data-aos-delay="100"
  data-aos-once="true"
>
  <AOSWrapper client:load />

  <GradientTitle title={t("skills.title")} />

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
    {
      skills.map((category, index) => (
        <div
          class="spotlight-card bg-gradient-to-br from-bg/90 via-muted/5 to-bg/90 backdrop-blur-2xl
             rounded-[2rem] border border-text/5 hover:border-orange-500/40 shadow-2xl hover:shadow-orange-500/20
             transition-all duration-500 hover:scale-[1.02]
             flex flex-col
             h-[540px] overflow-hidden relative group"
          aria-label={category.category}
          data-aos="zoom-in-up"
          data-aos-delay={index * 100}
          data-aos-once="true"
        >
          <div class="absolute -top-24 -right-24 w-48 h-48 bg-orange-500/5 rounded-full blur-[80px] pointer-events-none group-hover:bg-orange-500/10 transition-colors" />

          <h3
            class="relative z-20 text-center text-xl font-black tracking-tight
               card-header-gradient
               py-6 bg-bg/80 backdrop-blur-xl
               border-b border-white/5 rounded-t-3xl"
          >
            {category.category}
          </h3>

          {/* Mask Gradients */}
          <div class="absolute inset-x-0 top-[80px] h-16 bg-gradient-to-b from-[var(--color-bg)] to-transparent z-10 pointer-events-none opacity-80" />
          <div class="absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-[var(--color-bg)] to-transparent z-10 pointer-events-none opacity-80" />

          {/* Marquee Wrapper */}
          <div class="flex-1 overflow-hidden relative">
            <div class="animate-marquee-vertical flex flex-col hover:pause-animation pt-8">
              {/* Original List */}
              <ul class="px-4 grid grid-cols-2 gap-5 pb-10">
                {category.items.map((skill, i) => (
                  <li
                    class="group/skill flex flex-col items-center text-center 
                         bg-orange-500/5 dark:bg-white/[0.02] p-5 rounded-3xl
                         border border-black/5 dark:border-white/5 hover:border-orange-500/30 shadow-sm hover:shadow-[0_0_20px_rgba(249,115,22,0.1)]
                         transition-all duration-500 hover:-translate-y-1 cursor-default"
                    title={`${skill.name} - ${skill.level}`}
                  >
                    <div class="w-16 h-16 mb-4 flex items-center justify-center relative">
                      <div class="absolute inset-0 bg-orange-500/0 group-hover/skill:bg-orange-500/10 blur-xl transition-colors rounded-full" />
                      <Icon
                        name={skill.icon}
                        class="w-11 h-11 transition-all duration-500 group-hover/skill:scale-110 relative z-10 group-hover/skill:drop-shadow-[0_0_10px_rgba(249,115,22,0.5)]"
                        aria-hidden="true"
                      />
                    </div>
                    <span class="text-base font-bold tracking-tight skill-text">{skill.name}</span>
                    <div class="mt-3 w-full flex flex-col items-center gap-2">
                      <span class="text-[9px] uppercase tracking-[0.2em] font-black level-text">
                        {skill.level}
                      </span>
                      <div class="w-full h-1 bg-zinc-800/50 rounded-full overflow-hidden border border-white/5">
                        <div
                          class="h-full bg-gradient-to-r from-orange-600 to-yellow-400 opacity-80 group-hover/skill:opacity-100 transition-all duration-1000 ease-out"
                          style={{
                            width:
                              skill.level === "Básico" || skill.level === "Basic"
                                ? "33%"
                                : skill.level === "Intermedio" || skill.level === "Intermediate"
                                  ? "66%"
                                  : "100%",
                          }}
                        />
                      </div>
                    </div>
                  </li>
                ))}
              </ul>
              {/* Duplicate List for Loop */}
              <ul class="px-4 grid grid-cols-2 gap-5 pb-10" aria-hidden="true">
                {category.items.map((skill, i) => (
                  <li
                    class="group/skill flex flex-col items-center text-center 
                         bg-orange-500/5 dark:bg-white/[0.02] p-5 rounded-3xl
                         border border-black/5 dark:border-white/5 hover:border-orange-500/30 shadow-sm hover:shadow-[0_0_20px_rgba(249,115,22,0.1)]
                         transition-all duration-500 hover:-translate-y-1 cursor-default"
                    title={`${skill.name} - ${skill.level}`}
                  >
                    <div class="w-16 h-16 mb-4 flex items-center justify-center relative">
                      <div class="absolute inset-0 bg-orange-500/0 group-hover/skill:bg-orange-500/10 blur-xl transition-colors rounded-full" />
                      <Icon
                        name={skill.icon}
                        class="w-11 h-11 transition-all duration-500 group-hover/skill:scale-110 relative z-10 group-hover/skill:drop-shadow-[0_0_10px_rgba(249,115,22,0.5)]"
                        aria-hidden="true"
                      />
                    </div>
                    <span class="text-base font-bold tracking-tight skill-text">{skill.name}</span>
                    <div class="mt-3 w-full flex flex-col items-center gap-2">
                      <span class="text-[9px] uppercase tracking-[0.2em] font-black level-text">
                        {skill.level}
                      </span>
                      <div class="w-full h-1 bg-zinc-800/50 rounded-full overflow-hidden border border-white/5">
                        <div
                          class="h-full bg-gradient-to-r from-orange-600 to-yellow-400 opacity-80 group-hover/skill:opacity-100 transition-all duration-1000 ease-out"
                          style={{
                            width:
                              skill.level === "Básico" || skill.level === "Basic"
                                ? "33%"
                                : skill.level === "Intermedio" || skill.level === "Intermediate"
                                  ? "66%"
                                  : "100%",
                          }}
                        />
                      </div>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</section>

{/* Extracted SkillItem for cleanliness */}
{
  /* Using a local function component logic isn't standard in .astro files mid-render, so strictly rewriting inline or defining above is better. 
     I will rewrite inline to minimize structure changes, but since I need it twice, defining a simple functional rendering helper or duplicating code is needed.
     For Astro, I can just map twice with the same code block. */
}

<style>
  @keyframes marquee-vertical {
    0% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(-50%);
    }
  }

  .animate-marquee-vertical {
    animation: marquee-vertical 20s linear infinite;
  }

  /* Pause on hover for accessibility */
  .hover\:pause-animation:hover {
    animation-play-state: paused;
  }

  /* Theme-aware text colors with explicit selectors and high priority */

  /* Default / Light Mode */
  .skill-text {
    color: #ea580c !important; /* Orange-600 - Matches level color */
  }

  :global([data-theme="light"]) .skill-text {
    color: #ea580c !important; /* Force Orange-600 in light mode */
  }

  .level-text {
    color: rgba(234, 88, 12, 0.9); /* orange-600/90 */
  }

  /* Dark Mode Overrides */
  :global([data-theme="dark"]) .skill-text {
    color: #fff7ed !important; /* orange-50 */
  }

  :global([data-theme="dark"]) .level-text {
    color: rgba(249, 115, 22, 0.8); /* orange-500/80 */
  }

  /* Card Header Gradient */
  .card-header-gradient {
    background-image: linear-gradient(
      to right,
      #9a3412,
      #ea580c,
      #9a3412
    ); /* Default/Light: Dark Orange */
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  :global([data-theme="light"]) .card-header-gradient {
    background-image: linear-gradient(to right, #d88f3b, #ffcf9c, #d88f3b) !important;
  }

  :global([data-theme="dark"]) .card-header-gradient {
    background-image: linear-gradient(
      to right,
      #fb923c,
      #facc15,
      #ea580c
    ) !important; /* Orange-400 -> Yellow-400 -> Orange-600 */
  }
</style>

---
import { getCollection } from "astro:content";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import GradientTitle from "./GradientTitle.astro";
import { Icon } from "astro-iconify";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const posts = (await getCollection("blog"))
    .sort(
        (a, b) => Number(new Date(b.data.date)) - Number(new Date(a.data.date)),
    )
    .slice(0, 3); // Show latest 3
---

<section id="blog" class="max-w-5xl mx-auto py-20 px-6 scroll-mt-20">
    <GradientTitle title="Blog" />

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12">
        {
            posts.map((post) => (
                <a
                    href={`/blog/${post.slug}`}
                    class="spotlight-card group block p-6 rounded-2xl border border-text/10 bg-bg/50 backdrop-blur-md hover:border-accent/30 transition-all duration-300"
                >
                    <div class="flex items-center gap-2 text-xs text-orange-400 font-bold mb-3 uppercase tracking-widest">
                        <Icon name="mdi:calendar" class="w-4 h-4" />
                        {post.data.date
                            ? post.data.date.toLocaleDateString(
                                  lang === "es" ? "es-ES" : "en-US",
                                  {
                                      day: "numeric",
                                      month: "long",
                                      year: "numeric",
                                  },
                              )
                            : ""}
                    </div>
                    <h3 class="text-xl font-bold text-text mb-2 group-hover:text-accent transition-colors">
                        {post.data.title}
                    </h3>
                    <p class="text-muted text-sm line-clamp-2 leading-relaxed">
                        {post.data.description}
                    </p>
                    <div class="mt-4 flex items-center gap-2 text-accent text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity">
                        {lang === "es" ? "Leer más" : "Read more"}
                        <Icon name="mdi:arrow-right" class="w-4 h-4" />
                    </div>
                </a>
            ))
        }
    </div>

    <div class="mt-12 text-center">
        <p class="text-muted italic text-sm">Próximamente más artículos...</p>
    </div>
</section>

---
import { getLangFromUrl } from "../i18n/utils";
import { Font } from "astro:assets";
import { ClientRouter } from "astro:transitions";
import "../styles/global.css";
import LoadingIndicator from "astro-loading-indicator/component";
import Navbar from "../components/Navbar.astro";
import WarpBackground from "../components/WarpBackground";
import AOSWrapper from "../components/AOSWrapper.jsx";
import SpotlightEffect from "../components/SpotlightEffect.astro";
import ProgressBar from "../components/ProgressBar.astro";
import ScrollToTop from "../components/ScrollToTop.jsx";

const { title, description } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const defaultTitle = "Geovanni Gonzalez";
const defaultDescription =
  "Portfolio of Geovanni Gonzalez, computer engineering student at TEC, Costa Rica.";
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="title" content={title || defaultTitle} />
    <meta name="description" content={description || defaultDescription} />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO & Open Graph -->
    <link rel="canonical" href={Astro.url} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={title || defaultTitle} />
    <meta
      property="og:description"
      content={description || defaultDescription}
    />
    <meta
      property="og:image"
      content={new URL("/images/profile.webp", Astro.url)}
    />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content={title || defaultTitle} />
    <meta
      property="twitter:description"
      content={description || defaultDescription}
    />
    <meta
      property="twitter:image"
      content={new URL("/images/profile.webp", Astro.url)}
    />

    <Font cssVariable="--font-geist" preload />
    <ClientRouter />
    <LoadingIndicator color="#f4f4f5" height="2px" />
  </head>

  <body
    class="font-sans min-h-screen text-[var(--color-text)] transition-colors duration-300"
    aria-label="Contenido principal"
    tabindex="0"
  >
    <div
      class="fixed inset-0 -z-20 bg-[var(--color-bg)] transition-colors duration-300"
    >
    </div>
    <ProgressBar />
    <SpotlightEffect />
    <ScrollToTop client:load />
    <div class="warp-bg-wrapper">
      <WarpBackground
        darkColors={["#f97316", "#ea580c", "#7c2d12"]}
        lightColors={["#fb923c", "#f97316", "#ea580c"]}
        speed={0.8}
        swirl={0.9}
        swirlIterations={10}
        shapeScale={0.35}
        client:load
        className="fixed inset-0 -z-10"
        style={{
          position: "fixed",
          top: 0,
          left: 0,
          width: "100%",
          height: "100%",
          zIndex: -10,
        }}
      />
    </div>
    <Navbar lang={lang} />

    <main id="main-content" tabindex="-1" aria-label="SecciÃ³n principal">
      <slot />
    </main>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }

  /* Warp visible y vibrante en modo claro */
  :global([data-theme="light"]) .warp-bg-wrapper {
    opacity: 0.7;
    filter: none;
    transition: opacity 0.5s;
  }
</style>

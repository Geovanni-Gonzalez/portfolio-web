---
import { getCollection, type CollectionEntry } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Footer from "../../components/Footer.astro";
import { Icon } from "astro-iconify";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: post,
    }));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title} description={post.data.description}>
    <article class="max-w-4xl mx-auto px-6 py-32">
        <a
            href="/#blog"
            class="inline-flex items-center gap-2 text-accent hover:text-accent-light transition-colors mb-8 font-bold"
        >
            <Icon name="mdi:arrow-left" class="w-5 h-5" />
            Volver al inicio
        </a>

        <header class="mb-12">
            <div
                class="flex items-center gap-2 text-sm text-orange-400 font-bold mb-4 uppercase tracking-widest"
            >
                <Icon name="mdi:calendar" class="w-4 h-4" />
                {
                    post.data.pubDate.toLocaleDateString("es-ES", {
                        day: "numeric",
                        month: "long",
                        year: "numeric",
                    })
                }
            </div>
            <h1
                class="text-4xl md:text-6xl font-black text-text mb-6 leading-tight"
            >
                {post.data.title}
            </h1>
            <p class="text-xl text-muted leading-relaxed italic">
                {post.data.description}
            </p>
        </header>

        {
            post.data.heroImage && (
                <div class="rounded-3xl overflow-hidden border border-text/10 mb-12 shadow-2xl">
                    <img
                        src={post.data.heroImage}
                        alt={post.data.title}
                        class="w-full h-auto object-cover max-h-[500px]"
                        onerror="this.style.display='none'"
                    />
                </div>
            )
        }

        <div
            class="prose prose-invert prose-orange max-w-none
                prose-headings:text-text prose-p:text-muted prose-p:leading-relaxed
                prose-li:text-muted prose-strong:text-orange-400
                prose-code:text-accent prose-code:bg-accent/10 prose-code:px-1 prose-code:rounded"
        >
            <Content />
        </div>

        <div class="mt-20 pt-10 border-t border-text/10 flex flex-wrap gap-4">
            {
                post.data.tags.map((tag) => (
                    <span class="bg-accent/10 border border-accent/20 text-accent px-4 py-1.5 rounded-full text-sm font-bold">
                        #{tag}
                    </span>
                ))
            }
        </div>
    </article>
    <Footer />
</BaseLayout>
